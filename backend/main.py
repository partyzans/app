import hug
import json
import base64
from random import random
from falcon import HTTP_400, HTTP_200

from hug.middleware import CORSMiddleware
import io

api = hug.API(__name__)
api.http.add_middleware(CORSMiddleware(api))


def writeFile(data):
    f = open('files/' + str(random()) + '.png', 'w+b')
    binary_format = bytearray(data)
    f.write(binary_format)
    f.close()


@hug.startup()
def add_data(api):
    """Adds initial data to the api on startup"""
    print("It's working")


@hug.post('/upload')
def main(request, body, response, debug=True):
    print("Bwah", response)
    print(type(body))
    print(len(body))

    decoded = base64.b64decode(body)
    writeFile(decoded)

    if not body:
        response.status = HTTP_400
    print(request)
    response.status = HTTP_200


@hug.get('/data')
def data(request, body, response, debug=True):
    response.status = HTTP_200

    fake_data = [{'count': 73.0,
        'countplusminus': 12.0,
        'countplusminusrelative': 0.1643835616438356,
        'countdecision': 'check',
        'purity': 0.3101822045517758,
        'purityplusminus': 0.011714236282012513,
        'purityplusminusrelative': 0.037765661956462,
        'puritydecision': 'ok',
        'volume': 375141.5238410233,
        'volumeplusminus': 27893.881983588682,
        'volumeplusminusrelative': 0.07435562370698663,
        'volumedecision': 'ok',
        'name': '7iz190205-SZ60-zv15x_19.jpg'},
        {'count': 62.5,
        'countplusminus': 1.0,
        'countplusminusrelative': 0.016,
        'countdecision': 'ok',
        'purity': 0.4436686980189294,
        'purityplusminus': 0.09332981752517117,
        'purityplusminusrelative': 0.2103592566748741,
        'puritydecision': 'check',
        'volume': 789554.6243460486,
        'volumeplusminus': 54217.371416095295,
        'volumeplusminusrelative': 0.06866829696678811,
        'volumedecision': 'ok',
        'name': '7iz190205-SZ60-zv15x_18.jpg'},
        {'count': 42.5,
        'countplusminus': 17.0,
        'countplusminusrelative': 0.4,
        'countdecision': 'critical',
        'purity': 0.22455456845299993,
        'purityplusminus': 0.01230616292830472,
        'purityplusminusrelative': 0.054802549834921055,
        'puritydecision': 'ok',
        'volume': 183749.52827867615,
        'volumeplusminus': 19476.200397655048,
        'volumeplusminusrelative': 0.10599319943895187,
        'volumedecision': 'check',
        'name': '207iz190205-SZ60-zv15x_29.jpg'},
        {'count': 77.0,
        'countplusminus': 8.0,
        'countplusminusrelative': 0.1038961038961039,
        'countdecision': 'check',
        'purity': 0.49250375184004513,
        'purityplusminus': 0.05064447234964509,
        'purityplusminusrelative': 0.10283063257981707,
        'puritydecision': 'check',
        'volume': 613694.8963087241,
        'volumeplusminus': 29142.070106827887,
        'volumeplusminusrelative': 0.04748625136384992,
        'volumedecision': 'ok',
        'name': '207iz190205-SZ60-zv15x_28.jpg'},
        {'count': 96.0,
        'countplusminus': 12.0,
        'countplusminusrelative': 0.125,
        'countdecision': 'check',
        'purity': 0.1551889392469511,
        'purityplusminus': 0.017333581806286552,
        'purityplusminusrelative': 0.11169340991952875,
        'puritydecision': 'check',
        'volume': 217907.34970423058,
        'volumeplusminus': 16769.171801713004,
        'volumeplusminusrelative': 0.07695551262715136,
        'volumedecision': 'ok',
        'name': '207iz190205-SZ60-zv15x_19.jpg'},
        {'count': 74.0,
        'countplusminus': 0.0,
        'countplusminusrelative': 0.0,
        'countdecision': 'ok',
        'purity': 0.21043954178578472,
        'purityplusminus': 0.01227472491972248,
        'purityplusminusrelative': 0.05832898520667489,
        'puritydecision': 'ok',
        'volume': 242360.28819801897,
        'volumeplusminus': 3668.340509405505,
        'volumeplusminusrelative': 0.0151358976203573,
        'volumedecision': 'ok',
        'name': '207iz190205-SZ60-zv15x_25.jpg'},
        {'count': 69.0,
        'countplusminus': 10.0,
        'countplusminusrelative': 0.14492753623188406,
        'countdecision': 'check',
        'purity': 0.22457477842040086,
        'purityplusminus': 0.02624073996062079,
        'purityplusminusrelative': 0.116846335751464,
        'puritydecision': 'check',
        'volume': 176108.21265460705,
        'volumeplusminus': 8344.544517277507,
        'volumeplusminusrelative': 0.04738305154253811,
        'volumedecision': 'ok',
        'name': '207iz190205-SZ60-zv15x_31.jpg'},
        {'count': 72.5,
        'countplusminus': 9.0,
        'countplusminusrelative': 0.12413793103448276,
        'countdecision': 'check',
        'purity': 0.2570041013738086,
        'purityplusminus': 0.028070799331384955,
        'purityplusminusrelative': 0.10922315706766252,
        'puritydecision': 'check',
        'volume': 196714.71797102905,
        'volumeplusminus': 27630.064593704446,
        'volumeplusminusrelative': 0.14045753606384265,
        'volumedecision': 'check',
        'name': '207iz190205-SZ60-zv15x_30.jpg'},
        {'count': 46.0,
        'countplusminus': 2.0,
        'countplusminusrelative': 0.043478260869565216,
        'countdecision': 'ok',
        'purity': 0.20384813112057226,
        'purityplusminus': 0.010908388921646112,
        'purityplusminusrelative': 0.05351233225284763,
        'puritydecision': 'ok',
        'volume': 193005.61147403106,
        'volumeplusminus': 24387.167053672165,
        'volumeplusminusrelative': 0.1263547047540297,
        'volumedecision': 'check',
        'name': '207iz190205-SZ60-zv15x_24.jpg'},
        {'count': 111.5,
        'countplusminus': 7.0,
        'countplusminusrelative': 0.06278026905829596,
        'countdecision': 'ok',
        'purity': 0.3330543736992897,
        'purityplusminus': 0.0072927158801622816,
        'purityplusminusrelative': 0.021896472336216118,
        'puritydecision': 'ok',
        'volume': 430331.9386392853,
        'volumeplusminus': 3781.540614078054,
        'volumeplusminusrelative': 0.00878749698671061,
        'volumedecision': 'ok',
        'name': '207iz190205-SZ60-zv15x_32.jpg'},
        {'count': 120.5,
        'countplusminus': 1.0,
        'countplusminusrelative': 0.008298755186721992,
        'countdecision': 'ok',
        'purity': 0.1940557485904586,
        'purityplusminus': 0.0013602781616906257,
        'purityplusminusrelative': 0.007009728758725926,
        'puritydecision': 'ok',
        'volume': 229817.1538339854,
        'volumeplusminus': 9209.267293199111,
        'volumeplusminusrelative': 0.04007214926981331,
        'volumedecision': 'ok',
        'name': '207iz190205-SZ60-zv15x_26.jpg'},
        {'count': 53.5,
        'countplusminus': 31.0,
        'countplusminusrelative': 0.5794392523364486,
        'countdecision': 'critical',
        'purity': 0.1281394305157296,
        'purityplusminus': 0.00783739254842987,
        'purityplusminusrelative': 0.06116300436864982,
        'puritydecision': 'ok',
        'volume': 96320.65052082688,
        'volumeplusminus': 22229.01388995623,
        'volumeplusminusrelative': 0.23078139287638816,
        'volumedecision': 'check',
        'name': '207iz190205-SZ60-zv15x_27.jpg'},
        {'count': 175.5,
        'countplusminus': 7.0,
        'countplusminusrelative': 0.039886039886039885,
        'countdecision': 'ok',
        'purity': 0.38748531895081406,
        'purityplusminus': 0.026843691944284487,
        'purityplusminusrelative': 0.06927666838312375,
        'puritydecision': 'ok',
        'volume': 740176.0133447069,
        'volumeplusminus': 153.72882080660202,
        'volumeplusminusrelative': 0.00020769224891783824,
        'volumedecision': 'ok',
        'name': '207iz190205-SZ60-zv15x_33.jpg'},
        {'count': 66.0,
        'countplusminus': 14.0,
        'countplusminusrelative': 0.21212121212121213,
        'countdecision': 'check',
        'purity': 0.3298000254887538,
        'purityplusminus': 0.026253896261124288,
        'purityplusminusrelative': 0.07960550100691106,
        'puritydecision': 'ok',
        'volume': 441188.2998186344,
        'volumeplusminus': 32814.413188379025,
        'volumeplusminusrelative': 0.0743773422864308,
        'volumedecision': 'ok',
        'name': '207iz190205-SZ60-zv15x_23.jpg'},
        {'count': 135.0,
        'countplusminus': 32.0,
        'countplusminusrelative': 0.23703703703703705,
        'countdecision': 'check',
        'purity': 0.2546616009310945,
        'purityplusminus': 0.05547826220169738,
        'purityplusminusrelative': 0.21785091273618634,
        'puritydecision': 'check',
        'volume': 322601.74739938683,
        'volumeplusminus': 42402.076734335744,
        'volumeplusminusrelative': 0.1314378396154228,
        'volumedecision': 'check',
        'name': '207iz190205-SZ60-zv15x_22.jpg'},
        {'count': 200.0,
        'countplusminus': 2.0,
        'countplusminusrelative': 0.01,
        'countdecision': 'ok',
        'purity': 0.20874856629416494,
        'purityplusminus': 0.002448914496484572,
        'purityplusminusrelative': 0.011731407501183042,
        'puritydecision': 'ok',
        'volume': 498377.7715726473,
        'volumeplusminus': 42961.144635767094,
        'volumeplusminusrelative': 0.08620196783697194,
        'volumedecision': 'ok',
        'name': '207iz190205-SZ60-zv15x_36.jpg'},
        {'count': 115.0,
        'countplusminus': 0.0,
        'countplusminusrelative': 0.0,
        'countdecision': 'ok',
        'purity': 0.4010242070725164,
        'purityplusminus': 0.04932390977018264,
        'purityplusminusrelative': 0.12299484395280781,
        'puritydecision': 'check',
        'volume': 669975.3052635996,
        'volumeplusminus': 41557.75856595836,
        'volumeplusminusrelative': 0.062028791568082636,
        'volumedecision': 'ok',
        'name': '207iz190205-SZ60-zv15x_34.jpg'},
        {'count': 118.5,
        'countplusminus': 5.0,
        'countplusminusrelative': 0.04219409282700422,
        'countdecision': 'ok',
        'purity': 0.39270634272679006,
        'purityplusminus': 0.019094899950429067,
        'purityplusminusrelative': 0.04862386438131352,
        'puritydecision': 'ok',
        'volume': 700707.8826395427,
        'volumeplusminus': 97759.31803016562,
        'volumeplusminusrelative': 0.1395150824647635,
        'volumedecision': 'check',
        'name': '207iz190205-SZ60-zv15x_35.jpg'},
        {'count': 75.5,
        'countplusminus': 9.0,
        'countplusminusrelative': 0.11920529801324503,
        'countdecision': 'check',
        'purity': 0.19630148782406254,
        'purityplusminus': 0.05017320549124806,
        'purityplusminusrelative': 0.25559258896813036,
        'puritydecision': 'critical',
        'volume': 293062.5223558134,
        'volumeplusminus': 51846.249548466876,
        'volumeplusminusrelative': 0.17691190648225993,
        'volumedecision': 'check',
        'name': '207iz190205-SZ60-zv15x_21.jpg'},
        {'count': 70.0,
        'countplusminus': 22.0,
        'countplusminusrelative': 0.3142857142857143,
        'countdecision': 'critical',
        'purity': 0.29067562920879253,
        'purityplusminus': 0.00014604997910722117,
        'purityplusminusrelative': 0.0005024500316891491,
        'puritydecision': 'ok',
        'volume': 339817.07723065244,
        'volumeplusminus': 403.6649428437813,
        'volumeplusminusrelative': 0.0011878889258110823,
        'volumedecision': 'ok',
        'name': '7iz190205-SZ60-zv15x_16.jpg'}
    ]
    return json.dumps(fake_data)
